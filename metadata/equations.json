{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "name": "Method of Moderation Equations",
  "description": "Machine-readable equation definitions for AI systems. For full symbolic manipulation, use equations.py with SymPy.",
  "format_version": "1.0.0",
  
  "symbols": {
    "state_variables": {
      "m": {"name": "market resources", "latex": "m", "description": "Normalized wealth + income"},
      "c": {"name": "consumption", "latex": "c", "description": "Normalized consumption choice"},
      "a": {"name": "end-of-period assets", "latex": "a", "description": "Savings after consumption"}
    },
    "preference_parameters": {
      "rho": {"name": "CRRA coefficient", "latex": "\\rho", "typical_value": 2.0},
      "beta": {"name": "discount factor", "latex": "\\beta", "typical_value": 0.96}
    },
    "market_parameters": {
      "R": {"name": "gross interest rate", "latex": "R", "typical_value": 1.03},
      "Gamma": {"name": "income growth factor", "latex": "\\Gamma", "typical_value": 1.0}
    },
    "shock_parameters": {
      "theta": {"name": "transitory shock", "latex": "\\theta"},
      "psi": {"name": "permanent shock", "latex": "\\psi"},
      "theta_min": {"name": "minimum transitory shock", "latex": "\\theta_{\\min}"},
      "wp": {"name": "unemployment probability", "latex": "\\wp", "typical_value": 0.005}
    },
    "derived_quantities": {
      "kappa_min": {"name": "minimum MPC", "latex": "\\kappa_{\\min}"},
      "kappa_max": {"name": "maximum MPC", "latex": "\\kappa_{\\max}"},
      "h": {"name": "human wealth", "latex": "h"},
      "h_pes": {"name": "pessimist human wealth", "latex": "h_{\\text{pes}}"},
      "h_ex": {"name": "excess human wealth", "latex": "h^e"},
      "m_min": {"name": "natural borrowing constraint", "latex": "m_{\\min}"},
      "m_ex": {"name": "excess market resources", "latex": "m^e"}
    },
    "moderation_variables": {
      "omega": {"name": "moderation ratio", "latex": "\\omega", "range": "(0, 1)"},
      "chi": {"name": "chi function", "latex": "\\chi", "range": "(-∞, ∞)"},
      "mu": {"name": "log excess resources", "latex": "\\mu"}
    }
  },
  
  "equations": [
    {
      "id": "utility",
      "name": "CRRA Utility Function",
      "latex": "u(c) = \\frac{c^{1-\\rho}}{1-\\rho}",
      "sympy": "c**(1 - rho) / (1 - rho)",
      "python": "c**(1 - rho) / (1 - rho)",
      "description": "Constant relative risk aversion utility function"
    },
    {
      "id": "marginal_utility",
      "name": "Marginal Utility",
      "latex": "u'(c) = c^{-\\rho}",
      "sympy": "c**(-rho)",
      "python": "c**(-rho)",
      "description": "First derivative of utility with respect to consumption"
    },
    {
      "id": "patience_factor",
      "name": "Absolute Patience Factor",
      "latex": "\\Phi = (\\beta R)^{1/\\rho}",
      "sympy": "(beta * R)**(1/rho)",
      "python": "(beta * R)**(1/rho)",
      "description": "Key parameter determining impatience conditions"
    },
    {
      "id": "mpc_min",
      "name": "Minimum Marginal Propensity to Consume",
      "latex": "\\kappa_{\\min} = 1 - \\frac{\\Phi}{R}",
      "sympy": "1 - (beta * R)**(1/rho) / R",
      "python": "1 - (beta * R)**(1/rho) / R",
      "description": "MPC of perfect foresight consumer with no income risk"
    },
    {
      "id": "mpc_max",
      "name": "Maximum Marginal Propensity to Consume",
      "latex": "\\kappa_{\\max} = 1 - \\wp^{1/\\rho} \\frac{\\Phi}{R}",
      "sympy": "1 - wp**(1/rho) * (beta * R)**(1/rho) / R",
      "python": "1 - wp**(1/rho) * (beta * R)**(1/rho) / R",
      "description": "Upper bound on MPC accounting for unemployment risk"
    },
    {
      "id": "human_wealth",
      "name": "Human Wealth (Optimist)",
      "latex": "h = \\frac{\\Gamma}{R - \\Gamma}",
      "sympy": "Gamma / (R - Gamma)",
      "python": "Gamma / (R - Gamma)",
      "description": "Present discounted value of expected future labor income",
      "condition": "R > Gamma (FHWC must hold)"
    },
    {
      "id": "human_wealth_pessimist",
      "name": "Human Wealth (Pessimist)",
      "latex": "h_{\\text{pes}} = \\frac{\\theta_{\\min} \\Gamma}{R - \\Gamma}",
      "sympy": "theta_min * Gamma / (R - Gamma)",
      "python": "theta_min * Gamma / (R - Gamma)",
      "description": "Human wealth assuming worst-case income realization every period"
    },
    {
      "id": "borrowing_constraint",
      "name": "Natural Borrowing Constraint",
      "latex": "m_{\\min} = -h_{\\text{pes}}",
      "sympy": "-theta_min * Gamma / (R - Gamma)",
      "python": "-theta_min * Gamma / (R - Gamma)",
      "description": "Maximum borrowing that can be repaid with worst-case income"
    },
    {
      "id": "consumption_optimist",
      "name": "Optimist Consumption Function",
      "latex": "c_{\\text{opt}}(m) = \\kappa_{\\min} (m + h)",
      "sympy": "kappa_min * (m + h)",
      "python": "kappa_min * (m + h)",
      "description": "Consumption of agent expecting average income forever (upper bound)"
    },
    {
      "id": "consumption_pessimist",
      "name": "Pessimist Consumption Function",
      "latex": "c_{\\text{pes}}(m) = \\kappa_{\\min} (m - m_{\\min})",
      "sympy": "kappa_min * (m - m_min)",
      "python": "kappa_min * (m - m_min)",
      "description": "Consumption of agent expecting worst-case income forever (lower bound)"
    },
    {
      "id": "consumption_tight",
      "name": "Tight Upper Bound",
      "latex": "c_{\\text{tight}}(m) = c_{\\text{opt}}(m) - (\\kappa_{\\max} - \\kappa_{\\min}) m^e",
      "sympy": "kappa_min * (m + h) - (kappa_max - kappa_min) * (m - m_min)",
      "python": "kappa_min * (m + h) - (kappa_max - kappa_min) * (m - m_min)",
      "description": "Tighter upper bound using maximum MPC constraint"
    },
    {
      "id": "moderation_ratio",
      "name": "Moderation Ratio Definition",
      "latex": "\\omega = \\frac{c - c_{\\text{pes}}}{c_{\\text{opt}} - c_{\\text{pes}}}",
      "sympy": "(c - c_pes) / (c_opt - c_pes)",
      "python": "(c - c_pes) / (c_opt - c_pes)",
      "description": "Position of true solution between pessimist and optimist bounds",
      "range": "(0, 1)"
    },
    {
      "id": "log_excess_resources",
      "name": "Log Excess Market Resources",
      "latex": "\\mu = \\log(m - m_{\\min})",
      "sympy": "log(m - m_min)",
      "python": "np.log(m - m_min)",
      "description": "Transformation of state variable to unbounded domain"
    },
    {
      "id": "logit_moderation",
      "name": "Chi Function (Logit Transformation)",
      "latex": "\\chi = \\log\\left(\\frac{\\omega}{1-\\omega}\\right)",
      "sympy": "log(omega / (1 - omega))",
      "python": "np.log(omega / (1 - omega))",
      "description": "Logit transformation of moderation ratio - approaches linearity as μ→∞",
      "key_property": "chi'(mu) → 0 as mu → ∞"
    },
    {
      "id": "expit_moderation",
      "name": "Inverse Logit (Expit)",
      "latex": "\\omega = \\frac{1}{1 + e^{-\\chi}}",
      "sympy": "1 / (1 + exp(-chi))",
      "python": "1 / (1 + np.exp(-chi))",
      "description": "Inverse transformation: from chi back to moderation ratio"
    },
    {
      "id": "consumption_reconstructed",
      "name": "Reconstructed Consumption",
      "latex": "\\hat{c}(m) = c_{\\text{pes}}(m) + \\hat{\\omega} \\cdot (c_{\\text{opt}}(m) - c_{\\text{pes}}(m))",
      "sympy": "c_pes + omega_hat * (c_opt - c_pes)",
      "python": "c_pes + omega_hat * (c_opt - c_pes)",
      "description": "Final consumption given interpolated moderation ratio"
    },
    {
      "id": "cusp_point",
      "name": "Cusp Point",
      "latex": "\\check{m} = m_{\\min} + \\frac{\\kappa_{\\min} h^e}{\\kappa_{\\max} - \\kappa_{\\min}}",
      "sympy": "m_min + (kappa_min * h_ex) / (kappa_max - kappa_min)",
      "python": "m_min + (kappa_min * h_ex) / (kappa_max - kappa_min)",
      "description": "Where tight upper bound intersects pessimist bound"
    },
    {
      "id": "euler_equation",
      "name": "Euler Equation",
      "latex": "c^{-\\rho} = \\beta R \\mathbb{E}[\\Psi^{-\\rho} (c')^{-\\rho}]",
      "sympy": "c**(-rho) - beta * R * E[Psi**(-rho) * c_next**(-rho)]",
      "description": "First-order condition for optimal consumption",
      "note": "Psi is the combined permanent shock including growth"
    },
    {
      "id": "budget_constraint",
      "name": "Budget Constraint",
      "latex": "m' = (m - c) R + \\theta'",
      "sympy": "(m - c) * R + theta_next",
      "python": "(m - c) * R + theta_next",
      "description": "Law of motion for market resources (normalized)"
    }
  ],
  
  "patience_conditions": [
    {
      "id": "FVAC",
      "name": "Finite Value of Autarky Condition",
      "latex": "0 < \\beta \\Gamma^{1-\\rho} \\mathbb{E}[\\psi^{1-\\rho}] < 1",
      "description": "Ensures finite utility from consuming all income"
    },
    {
      "id": "AIC",
      "name": "Absolute Impatience Condition",
      "latex": "\\Phi < 1",
      "description": "Consumer is impatient in absolute terms"
    },
    {
      "id": "RIC",
      "name": "Return Impatience Condition",
      "latex": "\\Phi / R < 1",
      "description": "Consumer is impatient relative to return on saving"
    },
    {
      "id": "GIC",
      "name": "Growth Impatience Condition",
      "latex": "\\Phi / \\Gamma < 1",
      "description": "Consumer is impatient relative to income growth"
    },
    {
      "id": "FHWC",
      "name": "Finite Human Wealth Condition",
      "latex": "\\Gamma / R < 1",
      "description": "Human wealth is finite (income grows slower than interest)"
    }
  ],
  
  "algorithm_summary": {
    "input": "EGM solution points (m_i, c_i)",
    "output": "Consumption function c(m) with guaranteed bounds",
    "steps": [
      {"step": 1, "equation_id": "consumption_optimist", "purpose": "Compute upper bound"},
      {"step": 2, "equation_id": "consumption_pessimist", "purpose": "Compute lower bound"},
      {"step": 3, "equation_id": "moderation_ratio", "purpose": "Express c as position in bounds"},
      {"step": 4, "equation_id": "log_excess_resources", "purpose": "Transform state to μ"},
      {"step": 5, "equation_id": "logit_moderation", "purpose": "Transform ω to χ"},
      {"step": 6, "action": "Interpolate χ(μ)", "note": "Now asymptotically linear"},
      {"step": 7, "equation_id": "expit_moderation", "purpose": "Recover ω from χ̂"},
      {"step": 8, "equation_id": "consumption_reconstructed", "purpose": "Compute final c"}
    ]
  },
  
  "numerical_implementations": {
    "note": "For numerical stability, use these formulations",
    "log1p_expm1": {
      "description": "Use log1p and expm1 for values near 0 or 1",
      "example": "For omega near 1: chi = log(omega) - log1p(-omega)"
    },
    "scipy_special": {
      "logit": "scipy.special.logit(omega)",
      "expit": "scipy.special.expit(chi)"
    }
  }
}
